
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>eosfactory.shell.account &#8212; EOSFactory 3.0 documentation</title>
    <link rel="stylesheet" href="../../../_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">EOSFactory 3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for eosfactory.shell.account</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">inspect</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">import</span> <span class="nn">eosfactory.core.logger</span> <span class="k">as</span> <span class="nn">logger</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.errors</span> <span class="k">as</span> <span class="nn">errors</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.config</span> <span class="k">as</span> <span class="nn">config</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.setup</span> <span class="k">as</span> <span class="nn">setup</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.errors</span> <span class="k">as</span> <span class="nn">errors</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.interface</span> <span class="k">as</span> <span class="nn">interface</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.teos</span> <span class="k">as</span> <span class="nn">teos</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.interface</span> <span class="k">as</span> <span class="nn">interface</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.cleos</span> <span class="k">as</span> <span class="nn">cleos</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.cleos_get</span> <span class="k">as</span> <span class="nn">cleos_get</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.cleos_set</span> <span class="k">as</span> <span class="nn">cleos_set</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.cleos_sys</span> <span class="k">as</span> <span class="nn">cleos_sys</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.manager</span> <span class="k">as</span> <span class="nn">manager</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.testnet</span> <span class="k">as</span> <span class="nn">testnet</span>
<span class="kn">import</span> <span class="nn">eosfactory.core.account</span> <span class="k">as</span> <span class="nn">account</span>
<span class="kn">import</span> <span class="nn">eosfactory.shell.wallet</span> <span class="k">as</span> <span class="nn">wallet</span>


<span class="n">wallet_globals</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">wallet_singleton</span> <span class="o">=</span> <span class="kc">None</span>


<div class="viewcode-block" id="Account"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account">[docs]</a><span class="k">class</span> <span class="nc">Account</span><span class="p">():</span>
    <span class="sd">&#39;&#39;&#39;Methods to be ascribed to account objects, produced with </span>
<span class="sd">    :func:`.create_master_account` factories and :func:`.create_account`.</span>
<span class="sd">    &#39;&#39;&#39;</span>
<div class="viewcode-block" id="Account.add_methods_and_finalize"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.add_methods_and_finalize">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">add_methods_and_finalize</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Ascribes methodes to the given *account*, and finalizes the creation </span>
<span class="sd">        of this *account*.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">account</span><span class="o">.</span><span class="n">account_object_name</span> <span class="o">=</span> <span class="n">account_object_name</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span> 
            <span class="n">account</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span> <span class="o">+=</span> <span class="p">(</span><span class="bp">cls</span><span class="p">,)</span>

        <span class="n">get_account</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">GetAccount</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">is_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * Cross-checked: account object ``</span><span class="si">{}</span><span class="s1">`` mapped to an existing </span>
<span class="s1">            account ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">,</span> <span class="n">account</span><span class="o">.</span><span class="n">name</span><span class="p">),</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">put_account_to_wallet_and_on_stack</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">,</span> <span class="n">account</span><span class="p">)</span></div>

<div class="viewcode-block" id="Account.code"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.code">[docs]</a>    <span class="k">def</span> <span class="nf">code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wasm</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retrieve the code and ABI</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str): If set, the name of the file to save the contract </span>
<span class="sd">                .wast/wasm to.</span>
<span class="sd">            abi (str): If set, the name of the file to save the contract .abi to.</span>
<span class="sd">            wasm (bool): Save contract as wasm.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos_get</span><span class="o">.</span><span class="n">GetCode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * code()</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">OUT</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">))</span></div>

<div class="viewcode-block" id="Account.is_code"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.is_code">[docs]</a>    <span class="k">def</span> <span class="nf">is_code</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Determine whether contract is set to the account.</span>

<span class="sd">        Return:</span>
<span class="sd">            True if the retrieved hash code of the contract code is not null.    </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">get_code</span> <span class="o">=</span> <span class="n">cleos_get</span><span class="o">.</span><span class="n">GetCode</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_code</span><span class="o">.</span><span class="n">code_hash</span> <span class="o">==</span> \
        <span class="s2">&quot;0000000000000000000000000000000000000000000000000000000000000000&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">get_code</span><span class="o">.</span><span class="n">code_hash</span></div>

<div class="viewcode-block" id="Account.set_contract"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.set_contract">[docs]</a>    <span class="k">def</span> <span class="nf">set_contract</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">contract_dir</span><span class="p">,</span> 
            <span class="n">wasm_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">abi_file</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
            <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Create or update the contract.</span>

<span class="sd">        Call *EOSIO cleos* with the *set contract* command. Store the result,</span>
<span class="sd">        which is an object of the class :class:`.cleos_set.SetContract`, as</span>
<span class="sd">        the value of the *set_contract* attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            contract_dir (str): A path to a directory.</span>
<span class="sd">            wasm_file (str): The WASM file relative to the contract_dir.</span>
<span class="sd">            abi_file (str): The ABI file for the contract, relative to the </span>
<span class="sd">                contract-dir.</span>

<span class="sd">        See definitions of the remaining parameters: :func:`.cleos.common_parameters`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos_set</span><span class="o">.</span><span class="n">SetContract</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">contract_dir</span><span class="p">,</span> 
                    <span class="n">wasm_file</span><span class="p">,</span> <span class="n">abi_file</span><span class="p">,</span> 
                    <span class="n">permission</span><span class="p">,</span> <span class="n">expiration_sec</span><span class="p">,</span> 
                    <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                    <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                    <span class="n">ref_block</span><span class="p">,</span>
                    <span class="n">delay_sec</span><span class="p">,</span>
                    <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">OUT</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_contract</span> <span class="o">=</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Account.set_account_permission"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.set_account_permission">[docs]</a>    <span class="k">def</span> <span class="nf">set_account_permission</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">parent_permission_name</span><span class="p">,</span>
                <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_packed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set parameters dealing with account permissions.</span>

<span class="sd">        Call *EOSIO cleos* with the *set account permission* command. Store</span>
<span class="sd">        the result, which is an object of the </span>
<span class="sd">        class :class:`.cleos_set.SetAccountPermission`, as the value of the *account_permission* attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            permission_name (str or .Permission): The permission to set/delete an </span>
<span class="sd">                authority for.</span>
<span class="sd">            parent_permission_name (str or .Permission): The permission name of </span>
<span class="sd">                this parents permission (defaults to: &quot;active&quot;).</span>
<span class="sd">            authority (str or dict or filename):  None to delete.</span>

<span class="sd">        Exemplary values of the argument *authority*::</span>

<span class="sd">            # bob, carol are account objects created with </span>
<span class="sd">            # shell.account.create_account factory function</span>

<span class="sd">            &quot;EOS6MRyAjQq8ud7hVNYcfnVPJqcVpscN5So8BhtHuGYqET5GDW5CV&quot;</span>

<span class="sd">            bob.active()</span>

<span class="sd">            {</span>
<span class="sd">                &quot;threshold&quot; : 100, </span>
<span class="sd">                &quot;keys&quot; : [], </span>
<span class="sd">                &quot;accounts&quot; : </span>
<span class="sd">                    [</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;permission&quot;:</span>
<span class="sd">                                {</span>
<span class="sd">                                    &quot;actor&quot;: bob.active(),</span>
<span class="sd">                                    &quot;permission&quot;:&quot;active&quot;</span>
<span class="sd">                                },</span>
<span class="sd">                            &quot;weight&quot;:100</span>
<span class="sd">                        }</span>
<span class="sd">                    ]</span>
<span class="sd">            }</span>

<span class="sd">        See definitions of the remaining parameters: </span>
<span class="sd">        \:func:`.cleos.common_parameters`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            * Set action permission.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">SetAccountPermission</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">permission_name</span><span class="p">,</span> <span class="n">authority</span><span class="p">,</span> <span class="n">parent_permission_name</span><span class="p">,</span>
                <span class="n">permission</span><span class="p">,</span>
                <span class="n">expiration_sec</span><span class="p">,</span> 
                <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">return_packed</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                <span class="n">ref_block</span><span class="p">,</span>
                <span class="n">delay_sec</span><span class="p">,</span>
                <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            * account permission ``</span><span class="si">{}</span><span class="s1">``:</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">authority</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">account_permission</span> <span class="o">=</span> <span class="n">result</span></div>
    
<div class="viewcode-block" id="Account.set_action_permission"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.set_action_permission">[docs]</a>    <span class="k">def</span> <span class="nf">set_action_permission</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">requirement</span><span class="p">,</span>
                <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
                <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">return_packed</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span>
        <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Set parameters dealing with account permissions.</span>

<span class="sd">        Call *EOSIO cleos* with the *set action permission* command. Store the </span>
<span class="sd">        result, which is an object of the </span>
<span class="sd">        class :class:`.cleos_set.SetActionPermission`, as the value of the *action_permission* attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            code (str or .interface.Account): The account that owns the code for \</span>
<span class="sd">                the action.</span>
<span class="sd">            type (str): The type of the action.</span>
<span class="sd">            requirement (str): The permission name require for executing the given </span>
<span class="sd">                action.</span>

<span class="sd">        See definitions of the remaining parameters: \:func:`.cleos.common_parameters`.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * Set action permission.</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">SetActionPermission</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">requirement</span><span class="p">,</span>
                <span class="n">permission</span><span class="p">,</span>
                <span class="n">expiration_sec</span><span class="p">,</span> 
                <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">return_packed</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                <span class="n">ref_block</span><span class="p">,</span>
                <span class="n">delay_sec</span><span class="p">,</span>
                <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            * action permission ``</span><span class="si">{}</span><span class="s1">``:</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">type</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action_permission</span> <span class="o">=</span> <span class="n">result</span></div>


<div class="viewcode-block" id="Account.push_action"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.push_action">[docs]</a>    <span class="k">def</span> <span class="nf">push_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Push a transaction with a single action.</span>

<span class="sd">        Call *EOSIO cleos* with the *push action* command. Store the result,</span>
<span class="sd">        which is an object of the class :class:`.cleos.PushAction`,  as</span>
<span class="sd">        the value of the *action* attribute.</span>

<span class="sd">        Args:</span>
<span class="sd">            action (str or json or filename): Definition of the action to </span>
<span class="sd">                execute on the contract.</span>
<span class="sd">            data (str): The arguments to the contract.</span>

<span class="sd">        See definitions of the remaining parameters: </span>
<span class="sd">        \:func:`.cleos.common_parameters`.</span>

<span class="sd">        Attributes:</span>
<span class="sd">            account_name (str): The EOSIO name of the contract&#39;s account.</span>
<span class="sd">            console (str): *[&quot;processed&quot;][&quot;action_traces&quot;][0][&quot;console&quot;]* \</span>
<span class="sd">                component of EOSIO cleos responce.</span>
<span class="sd">            data (str): *[&quot;processed&quot;][&quot;action_traces&quot;][0][&quot;act&quot;][&quot;data&quot;]* \</span>
<span class="sd">                component of EOSIO cleos responce.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">data_json</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">PushAction</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">permission</span><span class="p">,</span> <span class="n">expiration_sec</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="p">,</span>
            <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            * push action ``</span><span class="si">{}</span><span class="s1">``:</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">action</span><span class="p">))</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39; +&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="n">data</span><span class="p">)))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">result</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_console</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">console</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_console</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">action</span> <span class="o">=</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Account.show_action"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.show_action">[docs]</a>    <span class="k">def</span> <span class="nf">show_action</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Implement the `push action` command without broadcasting. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">push_action</span><span class="p">(</span>
            <span class="n">action</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span>
            <span class="n">permission</span><span class="p">,</span> <span class="n">expiration_sec</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="n">force_unique</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="o">=</span><span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="n">max_net_usage</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="o">=</span><span class="n">ref_block</span><span class="p">,</span> <span class="n">delay_sec</span><span class="o">=</span><span class="n">delay_sec</span><span class="p">)</span></div>

<div class="viewcode-block" id="Account.table"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.Account.table">[docs]</a>    <span class="k">def</span> <span class="nf">table</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">scope</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> 
            <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
            <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">lower</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">upper</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Retrieve the contents of a database table</span>

<span class="sd">        Args:</span>
<span class="sd">            scope (str or .interface.Account): The scope within the account in </span>
<span class="sd">                which the table is found.</span>
<span class="sd">            table (str): The name of the table as specified by the contract abi.</span>
<span class="sd">            binary (bool): Return the value as BINARY rather than using abi to </span>
<span class="sd">                interpret as JSON. Default is *False*.</span>
<span class="sd">            limit (int): The maximum number of rows to return. Default is 10.</span>
<span class="sd">            lower (str): JSON representation of lower bound value of key, </span>
<span class="sd">                defaults to first.</span>
<span class="sd">            upper (str): JSON representation of upper bound value value of key, </span>
<span class="sd">                defaults to last.</span>

<span class="sd">        Returns:</span>
<span class="sd">            :class:`.cleos_set.SetTable` object</span>
<span class="sd">        &#39;&#39;&#39;</span>            
        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * Table ``</span><span class="si">{}</span><span class="s1">`` for ``</span><span class="si">{}</span><span class="s1">``</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">table_name</span><span class="p">,</span> <span class="n">scope</span><span class="p">))</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos_get</span><span class="o">.</span><span class="n">GetTable</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span> <span class="n">table_name</span><span class="p">,</span> <span class="n">scope</span><span class="p">,</span>
                    <span class="n">binary</span><span class="p">,</span> 
                    <span class="n">limit</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">,</span>
                    <span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">account_map</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">account_map</span><span class="p">()</span>
            <span class="n">scope</span> <span class="o">=</span> <span class="n">account_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">scope</span><span class="p">)]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">OUT</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">out_msg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span></div>

    <span class="k">def</span> <span class="nf">buy_ram</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">amount_kbytes</span><span class="p">,</span> <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">is_local_testnet</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">buy_ram_kbytes</span> <span class="o">=</span> <span class="mi">1</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos_sys</span><span class="o">.</span><span class="n">BuyRam</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span> <span class="n">amount_kbytes</span><span class="p">,</span>
            <span class="n">buy_ram_kbytes</span><span class="p">,</span>
            <span class="n">expiration_sec</span><span class="p">,</span>
            <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="p">,</span>
            <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            * Transfered RAM from </span><span class="si">{}</span><span class="s1"> to </span><span class="si">{}</span><span class="s1"> kbytes: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">payer</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">amount</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">delegate_bw</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">stake_net_quantity</span><span class="p">,</span> <span class="n">stake_cpu_quantity</span><span class="p">,</span>
        <span class="n">receiver</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">transfer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
        <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">is_verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">is_local_testnet</span><span class="p">():</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">receiver</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">receiver</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">cleos_sys</span><span class="o">.</span><span class="n">DelegateBw</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">receiver</span><span class="p">,</span>
            <span class="n">stake_net_quantity</span><span class="p">,</span> <span class="n">stake_cpu_quantity</span><span class="p">,</span>
            <span class="n">permission</span><span class="p">,</span>
            <span class="n">transfer</span><span class="p">,</span>
            <span class="n">expiration_sec</span><span class="p">,</span>
            <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
            <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
            <span class="n">ref_block</span><span class="p">,</span>
            <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span>
            <span class="p">)</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * Delegated stake from </span><span class="si">{}</span><span class="s1"> to </span><span class="si">{}</span><span class="s1"> NET: </span><span class="si">{}</span><span class="s1"> CPU: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">result</span><span class="o">.</span><span class="n">payer</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">receiver</span><span class="p">,</span>
            <span class="n">result</span><span class="o">.</span><span class="n">stake_net_quantity</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">stake_cpu_quantity</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">manager</span><span class="o">.</span><span class="n">accout_names_2_object_names</span><span class="p">(</span>
            <span class="s2">&quot;Account object name: </span><span class="si">{}</span><span class="se">\n</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">account_object_name</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">cleos</span><span class="o">.</span><span class="n">GetAccount</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">))),</span>
            <span class="kc">True</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span></div>
        

<div class="viewcode-block" id="create_master_account"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.create_master_account">[docs]</a><span class="k">def</span> <span class="nf">create_master_account</span><span class="p">(</span>
            <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
            <span class="n">owner_key</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">active_key</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create master account object in caller&#39;s global namespace.</span>

<span class="sd">    Start a singleton :class:`.shell.wallet.Wallet` object if there is no one </span>
<span class="sd">    in the global namespace already.</span>

<span class="sd">    If a local testnet is running, create an account object representing </span>
<span class="sd">    the *eosio* account. Put the account into the wallet. Put the account</span>
<span class="sd">    object into the global namespace of the caller, and return.</span>

<span class="sd">    Otherwise, an outer testnet has to be defined with the function</span>
<span class="sd">    :func:`.core.setup.set_nodeos_address`.</span>

<span class="sd">    If the *account_name* argument is set, check the testnet for presence of the </span>
<span class="sd">    account. If present, create a corresponding object and put the account </span>
<span class="sd">    into the wallet, and put the account object into the global namespace of </span>
<span class="sd">    the caller, and return. </span>
<span class="sd">    </span>
<span class="sd">    Otherwise start a registration procedure:    </span>
<span class="sd">    </span>
<span class="sd">        - if the argument *account_name* is not set, make it random</span>
<span class="sd">        - print registration data, namely:</span>
<span class="sd">            - account name</span>
<span class="sd">            - owner public key</span>
<span class="sd">            - active public key</span>
<span class="sd">            - owner private key</span>
<span class="sd">            - active private key</span>
<span class="sd">        - wait for the user to register the master account</span>
<span class="sd">        - . . . . </span>
<span class="sd">        - detect the named account on the remote testnet</span>
<span class="sd">        - put the account into the wallet</span>
<span class="sd">        - put the account object into the global namespace of the caller and \</span>
<span class="sd">            return</span>

<span class="sd">    Note: Name conflict:</span>
<span class="sd">        If a new account object, named as an existing one, is going to be added to </span>
<span class="sd">        the wallet, an error is reported. Then an offer is given to edith the </span>
<span class="sd">        mapping file in order to resolve the conflict. When the conflict is </span>
<span class="sd">        resolved, the procedure finishes successfully.   </span>

<span class="sd">    Args:</span>
<span class="sd">        account_object_name (str): The name of the account object returned.</span>
<span class="sd">        account_name (str): The name of an valid EOSIO account. Must be set if </span>
<span class="sd">            the testnode is not local.</span>
<span class="sd">        owner_key (str or .core.interface.Key): The owner public key. Must </span>
<span class="sd">            be set if the testnode is not local.</span>
<span class="sd">        active_key (str or .core.interface.Key): The active public key. Must </span>
<span class="sd">            be set if the testnode is not local.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">globals</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f_globals</span>
 
    <span class="k">if</span> <span class="n">account_object_name</span><span class="p">:</span> <span class="c1"># account_object_name==None in register_testnet</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Check the conditions:</span>
<span class="sd">        * a *Wallet* object is defined.</span>
<span class="sd">        * the account object name is not in use, already.    </span>
<span class="sd">        &#39;&#39;&#39;</span> 
        <span class="n">is_wallet_defined</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="nb">globals</span><span class="p">)</span>

        <span class="k">global</span> <span class="n">wallet_singleton</span>
        <span class="k">if</span> <span class="n">wallet_singleton</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">account_object_name</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">:</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">globals</span><span class="p">[</span><span class="n">account_object_name</span><span class="p">],</span> <span class="n">interface</span><span class="o">.</span><span class="n">Account</span><span class="p">):</span>
                <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                The global variable </span><span class="si">{}</span><span class="s1"> type is not *Account*.</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span>
                <span class="k">return</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                ######## Account object ``</span><span class="si">{}</span><span class="s1">`` restored from the blockchain.</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span> 
            <span class="k">return</span>

            <span class="c1">#wallet_singleton.is_name_taken(account_object_name, account_name)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">testnet</span><span class="o">.</span><span class="n">Testnet</span><span class="p">):</span>
        <span class="n">owner_key</span> <span class="o">=</span> <span class="n">account_name</span><span class="o">.</span><span class="n">owner_key</span>
        <span class="n">active_key</span> <span class="o">=</span> <span class="n">account_name</span><span class="o">.</span><span class="n">active_key</span>
        <span class="n">account_name</span> <span class="o">=</span> <span class="n">account_name</span><span class="o">.</span><span class="n">account_name</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        ######### Create a master account object ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span>                

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If the local testnet is running, create an account object representing the </span>
<span class="sd">    *eosio* account. Put the account into the wallet. Put the account object into </span>
<span class="sd">    the global namespace of the caller, and **return**.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">Eosio</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">is_local_testnet_running</span><span class="p">(</span><span class="n">account_object</span><span class="p">):</span>
        <span class="n">put_account_to_wallet_and_on_stack</span><span class="p">(</span>
            <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_object</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Otherwise, an outer testnet has to be defined with </span>
<span class="sd">    *setup.set_nodeos_address(&lt;url&gt;)*.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">if</span> <span class="n">manager</span><span class="o">.</span><span class="n">is_local_testnet</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">teos</span><span class="o">.</span><span class="n">is_local_node_process_running</span><span class="p">():</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    There is an local testnode process running, but its &#39;eosio` account is not like </span>
<span class="s1">    expected.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="p">)</span>

        <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    If the local testnet is not running, an outer testnet has to be defined with </span>
<span class="s1">    `setup.set_nodeos_address(&lt;url&gt;)`: use &#39;setup.set_nodeos_address(&lt;URL&gt;)&#39;</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    If the *account_name* argument is not set, it is randomized. Check the </span>
<span class="sd">    testnet for presence of the account. If present, create the corresponding </span>
<span class="sd">    object and see whether it is in the wallets. If so, put the account object into </span>
<span class="sd">    the global namespace of the caller. and **return**. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">first_while</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">GetAccount</span><span class="p">(</span>
            <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">owner_key</span><span class="p">,</span> <span class="n">active_key</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">first_while</span> <span class="ow">and</span> <span class="n">account_name</span> <span class="ow">and</span> <span class="n">owner_key</span> <span class="ow">and</span> <span class="n">active_key</span> \
                        <span class="ow">and</span> <span class="ow">not</span> <span class="n">account_object</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            There is no account named ``</span><span class="si">{}</span><span class="s1">`` in the blockchain.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">))</span>
            <span class="k">return</span>
        <span class="n">first_while</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">account_object</span><span class="o">.</span><span class="n">exists</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">account_object</span><span class="o">.</span><span class="n">has_keys</span><span class="p">:</span> <span class="c1"># it is your account</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    * Checking whether the wallet has keys to the account ``</span><span class="si">{}</span><span class="s1">``</span>
<span class="s1">                    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

                <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    * The account object is created.</span>
<span class="s1">                    &#39;&#39;&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">account_object_name</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">Account</span><span class="o">.</span><span class="n">add_methods_and_finalize</span><span class="p">(</span>
                        <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_object</span><span class="p">):</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                            * The account ``</span><span class="si">{}</span><span class="s1">`` is in the wallet.</span>
<span class="s1">                            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                        <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">account_object</span>

            <span class="k">else</span><span class="p">:</span> <span class="c1"># the name is taken by somebody else</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                ###</span>
<span class="s1">                You can try another name. Do you wish to do this?</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="p">)</span>
                <span class="n">decision</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;y/n &lt;&lt;&lt; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">decision</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
                    <span class="n">account_name</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
                        <span class="s2">&quot;enter the account name or nothing to make the name random &lt;&lt;&lt; &quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">owner_key_new</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">CreateKey</span><span class="p">(</span><span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">active_key_new</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">CreateKey</span><span class="p">(</span><span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">OUT</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            Use the following data to register a new account on a public testnet:</span>
<span class="s1">            Account Name: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            Owner Public Key: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            Active Public Key: </span><span class="si">{}</span><span class="s1"></span>

<span class="s1">            Owner Private Key: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            Active Private Key: </span><span class="si">{}</span><span class="s1"></span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">account_object</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">owner_key_new</span><span class="o">.</span><span class="n">key_public</span><span class="p">,</span>
                <span class="n">active_key_new</span><span class="o">.</span><span class="n">key_public</span><span class="p">,</span>
                <span class="n">owner_key_new</span><span class="o">.</span><span class="n">key_private</span><span class="p">,</span>
                <span class="n">active_key_new</span><span class="o">.</span><span class="n">key_private</span>
                <span class="p">))</span>
                
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">is_ready</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;enter &#39;go&#39; when ready or &#39;q&#39; to quit &lt;&lt;&lt; &quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">is_ready</span> <span class="o">==</span> <span class="s2">&quot;q&quot;</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">else</span><span class="p">:</span> 
                    <span class="k">if</span> <span class="n">is_ready</span> <span class="o">==</span> <span class="s2">&quot;go&quot;</span><span class="p">:</span>
                        <span class="k">break</span>
            <span class="n">account_name</span> <span class="o">=</span> <span class="n">account_object</span><span class="o">.</span><span class="n">name</span>
            <span class="n">owner_key</span> <span class="o">=</span> <span class="n">owner_key_new</span>
            <span class="n">active_key</span> <span class="o">=</span> <span class="n">active_key_new</span></div>


<div class="viewcode-block" id="create_account"><a class="viewcode-back" href="../../../rst/shell.account.html#eosfactory.shell.account.create_account">[docs]</a><span class="k">def</span> <span class="nf">create_account</span><span class="p">(</span>
        <span class="n">account_object_name</span><span class="p">,</span>
        <span class="n">creator</span><span class="p">,</span> 
        <span class="n">account_name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">owner_key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">active_key</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">stake_net</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stake_cpu</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
        <span class="n">permission</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">expiration_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">skip_sign</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">force_unique</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">max_cpu_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ref_block</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">delay_sec</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>        
        <span class="n">buy_ram_kbytes</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">buy_ram</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">transfer</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">restore</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&#39;&#39;&#39;Create master account object in caller&#39;s global namespace.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        account_object_name (str): The name of the account object returned.</span>
<span class="sd">        creator (str or .core.interface.Account): The account creating the new </span>
<span class="sd">            account</span>
<span class="sd">        account_name (str): The name of an valid EOSIO account. If not set, it </span>
<span class="sd">            is random.</span>
<span class="sd">        owner_key (.core.interface.Key): The *owner* key pair. If not set, it</span>
<span class="sd">            is random.</span>
<span class="sd">        active_key (.core.interface.Key): The *active* key pair. If not set, </span>
<span class="sd">            and the *owner_key* is set, it is substituted with the *owner_key*.</span>
<span class="sd">            Otherwise, it is random.</span>
<span class="sd">        stake_net (int): The amount of EOS delegated for net bandwidth.</span>
<span class="sd">        stake_cpu (int): The amount of EOS delegated for CPU bandwidth.</span>
<span class="sd">        buy_ram_kbytes (int): The amount of RAM bytes to purchase.</span>
<span class="sd">        transfer (bool): Transfer voting power and right to unstake EOS to </span>
<span class="sd">            receiver.</span>

<span class="sd">    See definitions of the remaining parameters: :func:`.cleos.common_parameters`.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">global</span> <span class="n">wallet_singleton</span>
    <span class="nb">globals</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">stack</span><span class="p">()[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">f_globals</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Check the conditions:</span>
<span class="sd">    * a *Wallet* object is defined;</span>
<span class="sd">    * the account object name is not in use, already.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">is_wallet_defined</span><span class="p">(</span><span class="n">logger</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wallet_singleton</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="c1">#wallet_singleton.is_name_taken(account_object_name, account_name)</span>

    <span class="k">if</span> <span class="n">account_object_name</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">:</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">globals</span><span class="p">[</span><span class="n">account_object_name</span><span class="p">],</span> <span class="n">interface</span><span class="o">.</span><span class="n">Account</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            The global variable ``</span><span class="si">{}</span><span class="s1">`` type is not *Account*.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span>
            <span class="k">return</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">            ######## Account object ``</span><span class="si">{}</span><span class="s1">`` restored from the blockchain.</span>
<span class="s1">            &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span> 
        <span class="k">return</span>        

    <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        ######### Create an account object ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">))</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Create an account object.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">account_object</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">restore</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">creator</span><span class="p">:</span>
            <span class="n">account_name</span> <span class="o">=</span> <span class="n">creator</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                    ... for an existing blockchain account ``</span><span class="si">{}</span><span class="s1">`` </span>
<span class="s1">                        mapped as ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">                    &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_object_name</span><span class="p">),</span> 
                    <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">RestoreAccount</span><span class="p">(</span><span class="n">account_name</span><span class="p">)</span>
        <span class="n">account_object</span><span class="o">.</span><span class="n">account_object_name</span> <span class="o">=</span> <span class="n">account_object_name</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">account_name</span><span class="p">:</span>
            <span class="n">account_name</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">account_name</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">owner_key</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">active_key</span><span class="p">:</span>
                <span class="n">active_key</span> <span class="o">=</span> <span class="n">owner_key</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">owner_key</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">CreateKey</span><span class="p">(</span><span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">active_key</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">CreateKey</span><span class="p">(</span><span class="n">is_verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stake_net</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">manager</span><span class="o">.</span><span class="n">is_local_testnet</span><span class="p">():</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                        ... delegating stake to a new blockchain account ``</span><span class="si">{}</span><span class="s1">`` mapped as ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">                        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">,</span> <span class="n">account_object_name</span><span class="p">))</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">SystemNewaccount</span><span class="p">(</span>
                        <span class="n">creator</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">owner_key</span><span class="p">,</span> <span class="n">active_key</span><span class="p">,</span>
                        <span class="n">stake_net</span><span class="p">,</span> <span class="n">stake_cpu</span><span class="p">,</span>
                        <span class="n">permission</span><span class="p">,</span>
                        <span class="n">buy_ram_kbytes</span><span class="p">,</span> <span class="n">buy_ram</span><span class="p">,</span>
                        <span class="n">transfer</span><span class="p">,</span>
                        <span class="n">expiration_sec</span><span class="p">,</span> 
                        <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                        <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                        <span class="n">ref_block</span><span class="p">,</span>
                        <span class="n">delay_sec</span>
                        <span class="p">)</span>
            <span class="k">except</span> <span class="n">errors</span><span class="o">.</span><span class="n">LowRamError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                * RAM needed is </span><span class="si">{}</span><span class="s1">.kByte, buying RAM </span><span class="si">{}</span><span class="s1">.kByte.</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">needs_kbyte</span><span class="p">,</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">deficiency_kbyte</span><span class="p">))</span>

                <span class="n">buy_ram_kbytes</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
                    <span class="n">e</span><span class="o">.</span><span class="n">deficiency_kbyte</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">SystemNewaccount</span><span class="p">(</span>
                        <span class="n">creator</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> <span class="n">owner_key</span><span class="p">,</span> <span class="n">active_key</span><span class="p">,</span>
                        <span class="n">stake_net</span><span class="p">,</span> <span class="n">stake_cpu</span><span class="p">,</span>
                        <span class="n">permission</span><span class="p">,</span>
                        <span class="n">buy_ram_kbytes</span><span class="p">,</span> <span class="n">buy_ram</span><span class="p">,</span>
                        <span class="n">transfer</span><span class="p">,</span>
                        <span class="n">expiration_sec</span><span class="p">,</span> 
                        <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                        <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                        <span class="n">ref_block</span><span class="p">,</span>
                        <span class="n">delay_sec</span>
                        <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">INFO</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                        ... for a new blockchain account ``</span><span class="si">{}</span><span class="s1">``.</span>
<span class="s1">                        &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_name</span><span class="p">))</span>
            <span class="n">account_object</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">CreateAccount</span><span class="p">(</span>
                    <span class="n">creator</span><span class="p">,</span> <span class="n">account_name</span><span class="p">,</span> 
                    <span class="n">owner_key</span><span class="p">,</span> <span class="n">active_key</span><span class="p">,</span>
                    <span class="n">permission</span><span class="p">,</span>
                    <span class="n">expiration_sec</span><span class="p">,</span> <span class="n">skip_sign</span><span class="p">,</span> <span class="n">dont_broadcast</span><span class="p">,</span> <span class="n">force_unique</span><span class="p">,</span>
                    <span class="n">max_cpu_usage</span><span class="p">,</span> <span class="n">max_net_usage</span><span class="p">,</span>
                    <span class="n">ref_block</span><span class="p">,</span>
                    <span class="n">delay_sec</span>
                    <span class="p">)</span>

        <span class="n">account_object</span><span class="o">.</span><span class="n">account_object_name</span> <span class="o">=</span> <span class="n">account_object_name</span>
        <span class="n">account_object</span><span class="o">.</span><span class="n">owner_key</span> <span class="o">=</span> <span class="n">owner_key</span>
        <span class="n">account_object</span><span class="o">.</span><span class="n">active_key</span> <span class="o">=</span> <span class="n">active_key</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">        * The account object is created.</span>
<span class="s1">        &#39;&#39;&#39;</span><span class="p">)</span>
    <span class="n">Account</span><span class="o">.</span><span class="n">add_methods_and_finalize</span><span class="p">(</span><span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_object</span><span class="p">)</span></div>


<span class="k">def</span> <span class="nf">reboot</span><span class="p">():</span>
    <span class="k">global</span> <span class="n">wallet_singleton</span>
    <span class="k">if</span> <span class="n">wallet_singleton</span><span class="p">:</span>
        <span class="n">wallet_singleton</span><span class="o">.</span><span class="n">delete_globals</span><span class="p">()</span>
    <span class="n">wallet</span><span class="o">.</span><span class="n">Wallet</span><span class="o">.</span><span class="n">wallet_single</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">del</span> <span class="n">wallet_singleton</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="n">wallet_singleton</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">global</span> <span class="n">wallet_globals</span>
    <span class="n">wallet_globals</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">setup</span><span class="o">.</span><span class="n">reboot</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">is_local_testnet_running</span><span class="p">(</span><span class="n">account_eosio</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">account_</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">GetAccount</span><span class="p">(</span>
            <span class="n">account_eosio</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">is_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">try</span><span class="p">:</span> <span class="c1"># remote eosio may have the [&quot;keys&quot;] array empty.</span>
        <span class="k">return</span> <span class="n">account_eosio</span><span class="o">.</span><span class="n">owner_key</span><span class="o">.</span><span class="n">key_public</span> <span class="o">==</span> <span class="n">account_</span><span class="o">.</span><span class="n">owner_key</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="kc">False</span>


<span class="k">def</span> <span class="nf">is_wallet_defined</span><span class="p">(</span><span class="n">logger</span><span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">wallet_globals</span>   
    <span class="k">if</span> <span class="ow">not</span> <span class="n">wallet_globals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    
    <span class="k">global</span> <span class="n">wallet_singleton</span>
    <span class="n">wallet_singleton</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">Wallet</span><span class="o">.</span><span class="n">wallet_single</span>

    <span class="k">if</span> <span class="n">wallet_singleton</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wallet</span><span class="o">.</span><span class="n">create_wallet</span><span class="p">(</span><span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">)</span>
        <span class="n">wallet_singleton</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">Wallet</span><span class="o">.</span><span class="n">wallet_single</span>

        <span class="k">if</span> <span class="n">wallet_singleton</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">errors</span><span class="o">.</span><span class="n">Error</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                Cannot find any `Wallet` object.</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="p">)</span>

    <span class="n">wallet_globals</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">Wallet</span><span class="o">.</span><span class="n">globals</span>


<span class="k">def</span> <span class="nf">put_account_to_wallet_and_on_stack</span><span class="p">(</span>
        <span class="n">account_object_name</span><span class="p">,</span> <span class="n">account_object</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">logger</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span> <span class="o">=</span> <span class="n">account_object</span>

    <span class="k">global</span> <span class="n">wallet_singleton</span>
    <span class="k">global</span> <span class="n">wallet_globals</span>

    <span class="k">if</span> <span class="n">account_object</span><span class="o">.</span><span class="n">owner_key</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">wallet_singleton</span><span class="o">.</span><span class="n">keys_in_wallets</span><span class="p">(</span>
                <span class="p">[</span><span class="n">account_object</span><span class="o">.</span><span class="n">owner_key</span><span class="o">.</span><span class="n">key_private</span><span class="p">,</span>
                <span class="n">account_object</span><span class="o">.</span><span class="n">active_key</span><span class="o">.</span><span class="n">key_private</span><span class="p">]):</span>
            <span class="n">wallet_singleton</span><span class="o">.</span><span class="n">map_account</span><span class="p">(</span><span class="n">account_object</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">wallet_singleton</span><span class="o">.</span><span class="n">import_key</span><span class="p">(</span><span class="n">account_object</span><span class="p">):</span>
                <span class="n">wallet_singleton</span><span class="o">.</span><span class="n">map_account</span><span class="p">(</span><span class="n">account_object</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">TRACE</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;</span>
<span class="s1">                Wrong or missing keys for the account ``</span><span class="si">{}</span><span class="s1">`` in the wallets.</span>
<span class="s1">                &#39;&#39;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">account_object</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="c1"># export the account object to the globals in the wallet module:</span>
    <span class="k">global</span> <span class="n">wallet_globals</span>      
    <span class="n">wallet_globals</span><span class="p">[</span><span class="n">account_object_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">account_object</span>
    <span class="n">account_object</span><span class="o">.</span><span class="n">in_wallet_on_stack</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">True</span>


<span class="k">def</span> <span class="nf">print_stats</span><span class="p">(</span>
        <span class="n">accounts</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> 
        <span class="n">last_col</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%15s</span><span class="s2">&quot;</span>
    <span class="p">):</span>
    <span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="n">json</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="n">json</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
                <span class="n">rv</span> <span class="o">=</span> <span class="n">rv</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">rv</span> <span class="o">=</span> <span class="s2">&quot;n/a&quot;</span>
        <span class="k">return</span> <span class="n">rv</span>

    <span class="n">jsons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">account</span> <span class="ow">in</span> <span class="n">accounts</span><span class="p">:</span>
        <span class="n">json</span> <span class="o">=</span> <span class="n">cleos</span><span class="o">.</span><span class="n">GetAccount</span><span class="p">(</span><span class="n">account</span><span class="p">,</span> <span class="n">is_info</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">is_verbose</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">json</span>
        <span class="n">json</span><span class="p">[</span><span class="s2">&quot;account_object_name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">account</span><span class="o">.</span><span class="n">account_object_name</span>
        <span class="n">jsons</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">json</span><span class="p">)</span>

    <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">json</span> <span class="ow">in</span> <span class="n">jsons</span><span class="p">:</span>
        <span class="n">header</span> <span class="o">=</span> <span class="n">header</span> <span class="o">+</span> <span class="n">col</span> <span class="o">%</span> <span class="p">(</span><span class="n">json</span><span class="p">[</span><span class="s2">&quot;account_object_name&quot;</span><span class="p">])</span>
    <span class="n">output</span> <span class="o">=</span> <span class="s2">&quot;.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">header</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>

    <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">json</span> <span class="ow">in</span> <span class="n">jsons</span><span class="p">:</span>
            <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="n">col</span> <span class="o">%</span> <span class="n">find</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">json</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s2">&quot;  &quot;</span> <span class="o">+</span> <span class="n">last_col</span> <span class="o">%</span> <span class="p">(</span><span class="n">param</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> 

    <span class="n">logger</span><span class="o">.</span><span class="n">OUT</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">translate</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">EOSFactory 3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2018, Tokenika.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.0.0+/d7594ac.
    </div>
  </body>
</html>